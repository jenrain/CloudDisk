{"ast":null,"code":"export default {\n  name: \"ImagePlayer\",\n  props: {\n    currentImg: {\n      type: Object,\n\n      default() {\n        return {\n          name: \"\",\n          path: \"\"\n        };\n      }\n\n    },\n    isImgDialogShow: {\n      type: Boolean,\n\n      default() {\n        return false;\n      }\n\n    }\n  },\n\n  data() {\n    return {\n      currentImg: this.currentImg,\n      filePath: \"\",\n      isPlayerShow: false,\n      // 显示比例\n      currentScale: 1,\n      // 旋转角度\n      rotateDeg: 0,\n      // 移动的位置\n      movePosition: {\n        x: 0,\n        y: 0\n      }\n    };\n  },\n\n  methods: {\n    // 放大缩小\n    changeSize(size) {\n      if (size == \"large\") {\n        this.currentScale += 0.1;\n      } else {\n        if (this.currentScale > 0.2) {\n          this.currentScale -= 0.1;\n        }\n      }\n    },\n\n    // 点击旋转的回调\n    rotateImg() {\n      this.rotateDeg += 90;\n      this.rotateDeg == 360 ? 0 : this.rotateDeg;\n    },\n\n    mousewheelFn(e) {\n      console.log(e);\n\n      if (e.wheelDelta > 0 || e.detail < 0) {\n        this.changeSize(\"large\");\n      } else {\n        this.changeSize(\"small\");\n      }\n    }\n\n  },\n\n  created() {\n    console.log(\"开始获取文件路径\");\n    this.$axios.defaults.headers.common[\"Authorization\"] = window.localStorage.getItem(\"token\");\n    this.$axios({\n      url: \"/file/path/get\",\n      method: \"post\",\n      data: {\n        repository_identity: this.currentImg.repository_identity,\n        ext: this.currentImg.ext\n      }\n    }).then(res => {\n      console.log(res.data);\n\n      if (res.data.success) {\n        // 获取文件路径成功\n        this.filePath = res.data.path;\n        console.log(\"文件路径：\", this.filePath);\n      }\n    });\n  },\n\n  watch: {\n    isImgDialogShow(current) {\n      console.log(\"文件的信息：\", this.currentImg);\n      let mousewheel = navigator.userAgent.indexOf(\"Firefox\") > -1 ? \"DOMMouseScroll\" : \"mousewheel\";\n      this.isPlayerShow = current;\n\n      if (current == false) {\n        // window.onmousewheel = null;\n        window.removeEventListener(mousewheel, this.mousewheelFn); // 关闭时重置\n\n        this.currentScale = 1;\n        this.movePosition = {\n          x: 0,\n          y: 0\n        };\n        this.rotateDeg = 0;\n      } else {\n        // 开启时监听滚轮事件\n        window.addEventListener(mousewheel, this.mousewheelFn);\n      }\n    }\n\n  }\n};","map":{"version":3,"mappings":"AA+CA;EACAA,mBADA;EAEAC;IACAC;MACAC,YADA;;MAEAC;QACA;UACAJ,QADA;UAEAK;QAFA;MAIA;;IAPA,CADA;IAUAC;MACAH,aADA;;MAEAC;QACA;MACA;;IAJA;EAVA,CAFA;;EAmBAG;IACA;MACAL,2BADA;MAEAM,YAFA;MAGAC,mBAHA;MAIA;MACAC,eALA;MAMA;MACAC,YAPA;MAQA;MACAC;QACAC,IADA;QAEAC;MAFA;IATA;EAcA,CAlCA;;EAmCAC;IACA;IACAC;MACA;QACA;MACA,CAFA,MAEA;QACA;UACA;QACA;MACA;IACA,CAVA;;IAWA;IACAC;MACA;MACA;IACA,CAfA;;IAiBAC;MACAC;;MACA;QACA;MACA,CAFA,MAEA;QACA;MACA;IACA;;EAxBA,CAnCA;;EA6DAC;IACAD;IACA,uDACAE,oCADA;IAEA;MACAC,qBADA;MAEAC,cAFA;MAGAhB;QACAiB,wDADA;QAEAC;MAFA;IAHA,GAOAC,IAPA,CAOAC;MACAR;;MACA;QACA;QACA;QACAA;MACA;IACA,CAdA;EAeA,CAhFA;;EAiFAS;IACAtB;MACAa;MAEA,iBACAU,8CACA,gBADA,GAEA,YAHA;MAIA;;MACA;QACA;QACAR,0DAFA,CAGA;;QACA;QACA;UACAR,IADA;UAEAC;QAFA;QAIA;MACA,CAVA,MAUA;QACA;QACAO;MACA;IACA;;EAvBA;AAjFA","names":["name","props","currentImg","type","default","path","isImgDialogShow","data","filePath","isPlayerShow","currentScale","rotateDeg","movePosition","x","y","methods","changeSize","rotateImg","mousewheelFn","console","created","window","url","method","repository_identity","ext","then","res","watch","navigator"],"sourceRoot":"src/components","sources":["ImagePlayer.vue"],"sourcesContent":["<template>\r\n  <div class=\"ImagePlayer\" v-if=\"isImgDialogShow\">\r\n    <!-- 查看图片的dialog -->\r\n    <el-dialog\r\n      :title=\"currentImg.name\"\r\n      :visible.sync=\"isPlayerShow\"\r\n      @close=\"$emit('closeDialog')\"\r\n    >\r\n      <div class=\"dialogImgContainer\">\r\n        <img\r\n          :src=\"filePath\"\r\n          alt=\"\"\r\n          class=\"dialogImg\"\r\n          :style=\"[\r\n            {\r\n              transform: `scale(${currentScale}) rotate(${rotateDeg}deg) translate(${movePosition.x}px,${movePosition.y}px)`,\r\n            },\r\n          ]\"\r\n          @dragstart=\"(e) => e.preventDefault()\"\r\n          draggable=\"false\"\r\n        />\r\n      </div>\r\n    </el-dialog>\r\n    <div class=\"control\">\r\n      <i class=\"iconfont icon-fangda\" @click=\"changeSize('large')\"></i>\r\n      <i class=\"iconfont icon-suoxiao\" @click=\"changeSize('small')\"></i>\r\n      <i class=\"iconfont icon-youxuan\" @click=\"rotateImg\"></i>\r\n      <i\r\n        class=\"iconfont icon-shoucang\"\r\n        v-if=\"currentImg.collection == 0 || currentImg.collection == null\"\r\n        @click=\"$emit('collectCurrentImg', { flag: true, item: currentImg })\"\r\n      ></i>\r\n      <img\r\n        src=\"../assets/img/collect.png\"\r\n        alt=\"\"\r\n        @click=\"$emit('collectCurrentImg', { flag: false, item: currentImg })\"\r\n        v-else-if=\"currentImg.collection == 1\"\r\n      />\r\n      <i\r\n        class=\"iconfont icon-fenxiang\"\r\n        @click=\"$emit('shareCurrentFile', currentImg)\"\r\n      ></i>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nexport default {\r\n  name: \"ImagePlayer\",\r\n  props: {\r\n    currentImg: {\r\n      type: Object,\r\n      default() {\r\n        return {\r\n          name: \"\",\r\n          path: \"\",\r\n        };\r\n      },\r\n    },\r\n    isImgDialogShow: {\r\n      type: Boolean,\r\n      default() {\r\n        return false;\r\n      },\r\n    },\r\n  },\r\n  data() {\r\n    return {\r\n      currentImg: this.currentImg,\r\n      filePath: \"\",\r\n      isPlayerShow: false,\r\n      // 显示比例\r\n      currentScale: 1,\r\n      // 旋转角度\r\n      rotateDeg: 0,\r\n      // 移动的位置\r\n      movePosition: {\r\n        x: 0,\r\n        y: 0,\r\n      },\r\n    };\r\n  },\r\n  methods: {\r\n    // 放大缩小\r\n    changeSize(size) {\r\n      if (size == \"large\") {\r\n        this.currentScale += 0.1;\r\n      } else {\r\n        if (this.currentScale > 0.2) {\r\n          this.currentScale -= 0.1;\r\n        }\r\n      }\r\n    },\r\n    // 点击旋转的回调\r\n    rotateImg() {\r\n      this.rotateDeg += 90;\r\n      this.rotateDeg == 360 ? 0 : this.rotateDeg;\r\n    },\r\n\r\n    mousewheelFn(e) {\r\n      console.log(e);\r\n      if (e.wheelDelta > 0 || e.detail < 0) {\r\n        this.changeSize(\"large\");\r\n      } else {\r\n        this.changeSize(\"small\");\r\n      }\r\n    },\r\n  },\r\n  created() {\r\n    console.log(\"开始获取文件路径\");\r\n    this.$axios.defaults.headers.common[\"Authorization\"] =\r\n        window.localStorage.getItem(\"token\");\r\n      this.$axios({\r\n        url: \"/file/path/get\",\r\n        method: \"post\",\r\n        data: {\r\n          repository_identity: this.currentImg.repository_identity,\r\n          ext: this.currentImg.ext,\r\n        },\r\n      }).then((res) => {\r\n        console.log(res.data);\r\n        if (res.data.success) {\r\n          // 获取文件路径成功\r\n          this.filePath = res.data.path;\r\n          console.log(\"文件路径：\", this.filePath);\r\n        }\r\n      });\r\n  },\r\n  watch: {\r\n    isImgDialogShow(current) {\r\n      console.log(\"文件的信息：\", this.currentImg);\r\n\r\n      let mousewheel =\r\n        navigator.userAgent.indexOf(\"Firefox\") > -1\r\n          ? \"DOMMouseScroll\"\r\n          : \"mousewheel\";\r\n      this.isPlayerShow = current;\r\n      if (current == false) {\r\n        // window.onmousewheel = null;\r\n        window.removeEventListener(mousewheel, this.mousewheelFn);\r\n        // 关闭时重置\r\n        this.currentScale = 1;\r\n        this.movePosition = {\r\n          x: 0,\r\n          y: 0,\r\n        };\r\n        this.rotateDeg = 0;\r\n      } else {\r\n        // 开启时监听滚轮事件\r\n        window.addEventListener(mousewheel, this.mousewheelFn);\r\n      }\r\n    },\r\n  },\r\n};\r\n</script>\r\n\r\n<style scoped>\r\n* {\r\n  user-select: none;\r\n}\r\n\r\n.dialogImg {\r\n  max-width: 95%;\r\n  max-height: 95%;\r\n}\r\n\r\n.ImagePlayer /deep/ .el-dialog {\r\n  height: 80vh;\r\n  width: 70vw;\r\n  margin-top: 7vh !important;\r\n  border-radius: 10px;\r\n}\r\n\r\n.ImagePlayer /deep/ .el-dialog__header {\r\n  padding: 0;\r\n  width: 100%;\r\n  text-align: center;\r\n  min-height: 45px;\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n}\r\n\r\n.ImagePlayer /deep/ .el-dialog__body {\r\n  padding: 0;\r\n  margin: 0 auto 20px;\r\n  width: 100%;\r\n  height: calc(100% - 45px);\r\n}\r\n\r\n.ImagePlayer /deep/ .el-dialog__headerbtn {\r\n  top: 15px;\r\n}\r\n\r\n.dialogImgContainer {\r\n  width: 100%;\r\n  height: 95%;\r\n  display: flex;\r\n  justify-content: center;\r\n  align-items: center;\r\n  overflow: hidden;\r\n}\r\n\r\n.dialogImgContainer img {\r\n  height: 95%;\r\n}\r\n\r\n.control {\r\n  position: fixed;\r\n  bottom: calc(13% - 50px);\r\n  left: 50%;\r\n  transform: translateX(-50%);\r\n  z-index: 3000;\r\n  background-color: #fff;\r\n  padding: 10px;\r\n  border-radius: 10px;\r\n  display: flex;\r\n  align-items: center;\r\n  height: 40px;\r\n  box-sizing: border-box;\r\n}\r\n\r\n.control i,\r\n.control img {\r\n  margin: 0 10px;\r\n  cursor: pointer;\r\n}\r\n\r\n.control img {\r\n  width: 16px;\r\n  height: 16px;\r\n  cursor: pointer;\r\n}\r\n</style>\r\n"]},"metadata":{},"sourceType":"module"}