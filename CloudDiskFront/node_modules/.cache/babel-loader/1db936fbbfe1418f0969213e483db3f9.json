{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport axios from \"axios\";\nimport AsideBar from \"../components/AsideBar.vue\";\nimport UserInfoCard from \"../components/UserInfoCard.vue\";\nexport default {\n  components: {\n    AsideBar,\n    UserInfoCard\n  },\n  name: \"Index\",\n\n  data() {\n    return {\n      asideBarData: [{\n        path: \"/files\",\n        name: \"文件\",\n        icon: \"wenjian\",\n        componentName: \"files\",\n        params: {\n          path: \"/root\"\n        }\n      }, {\n        path: \"/albums\",\n        name: \"相册\",\n        icon: \"xiangce1\"\n      }, {\n        path: \"/collectes\",\n        name: \"收藏夹\",\n        icon: \"favorite\"\n      }],\n      downloadFileInfo: {\n        name: \"\",\n        url: \"\"\n      }\n    };\n  },\n\n  methods: {\n    // 点击下载文件的回调\n    downloadCurrentFile(name, url) {\n      axios.get(url, {\n        responseType: \"blob\"\n      }).then(res => {\n        let blob = res.data;\n        let url = URL.createObjectURL(blob); // download(url);\n\n        console.log(url);\n        let a = document.querySelector(\"#downloadCurrentFile\");\n        this.downloadFileInfo.name = name;\n        this.downloadFileInfo.url = url; // console.log(a);\n        //   console.log(this.downloadFileInfo.url.split(\"com\")[1]);\n\n        this.$nextTick(() => {\n          a.click(); // 用完释放URL对象\n\n          URL.revokeObjectURL(url);\n        });\n      });\n    },\n\n    // 放下拖拽文件的回调\n    dropFile(e) {\n      // console.log(e);\n      // console.log(e.dataTransfer.files[0]);\n      let originLength = this.$store.state.uploadProgressList.length; // e.dataTransfer.files.forEach((item, index) => {\n\n      let param = new FormData();\n      param.append(\"file\", item);\n      console.log(item);\n      let arr = this.$store.state.uploadProgressList; // uploadProgressList push一个对象\n\n      arr.push({\n        name: item.name,\n        progress: 0\n      }); // let config = {\n      //   header: { \"Content-Type\": \"multipart/form-data\" },\n      //   onUploadProgress: (progressEvent) => {\n      //     // this.isUploadProgressShow = true;\n      //     // console.log(arr.length);\n      //     arr[index + originLength].progress =\n      //       ((progressEvent.loaded / progressEvent.total) * 100) | 0;\n      //     this.$store.commit(\"updateUploadProgressList\", arr);\n      //     // console.log(complete);\n      //     // console.log(progressEvent);\n      //   },\n      // };\n      // axios\n      //   .post(\n      //     `/api/eduoss/fileoss/upload/${this.$store.state.userInfo.id}?catalogue=${this.$store.state.currentFolder}`,\n      //     param,\n      //     config\n      //   )\n      //   .then((response) => {\n      //     console.log(response);\n      //     if (!response.data.success) {\n      //       this.$message.error(\n      //         `${response.data.data.file.name}上传失败,请稍后重试!`\n      //       );\n      //       // this.isUploadProgressShow = false;\n      //       // 不能直接用索引删除 因为如果之前已经有前面的索引被删除了，会导致后面的索引跟着发生变化 但又没有唯一标识 所以根据文件名进行删除（重名情况下默认删除第一个）\n      //       let idx = arr.findIndex((i) => {\n      //         return i.name == item.name;\n      //       });\n      //       arr.splice(idx, 1);\n      //       this.$store.commit(\"updateUploadProgressList\", arr);\n      //       return;\n      //     }\n      //     let data = {\n      //       memId: this.$store.state.userInfo.id,\n      //       url: response.data.data.file.url,\n      //       name: response.data.data.file.name,\n      //       type: response.data.data.file.type,\n      //       videoId: response.data.data.file.videoId,\n      //       filetype: response.data.data.file.filetype,\n      //       fdir: response.data.data.file.fdir,\n      //       size: response.data.data.file.size,\n      //     };\n      //     console.log(data);\n      //     this.updateToSQL(data, item.name);\n      //   })\n\n      this.$axios({\n        url: \"/file/upload\",\n        method: \"post\",\n        param\n      }).then(res => {\n        console.log(res.data);\n\n        if (!response.data.success) {\n          this.$message.error(res.data.msg); // this.isUploadProgressShow = false;\n          // 不能直接用索引删除 因为如果之前已经有前面的索引被删除了，会导致后面的索引跟着发生变化 但又没有唯一标识 所以根据文件名进行删除（重名情况下默认删除第一个）\n\n          let idx = arr.findIndex(i => {\n            return i.name == item.name;\n          });\n          arr.splice(idx, 1);\n          this.$store.commit(\"updateUploadProgressList\", arr);\n          return;\n        }\n      }).catch(err => {\n        console.log(err);\n        this.$message.error(\"上传失败!\");\n      }); // });\n    }\n\n  },\n  watch: {\n    \"$store.state.currentDownloadFileInfo\"(current) {\n      this.downloadCurrentFile(current.name, current.url);\n    },\n\n    \"$store.state.currentFolder\"(current) {\n      this.asideBarData[0].params.path = current;\n    },\n\n    \"$route.params.path\"(current) {\n      // console.log(this.$route.name==files);\n      if (this.$route.name == \"files\") {\n        this.$store.commit(\"updateCurrentFolder\", current);\n        console.log(207);\n      } // if (this.isCreated) {\n      //   this.getListData();\n      //   // console.log(\"199\");\n      // }\n\n    }\n\n  }\n};","map":{"version":3,"mappings":";AAoBA;AAEA;AACA;AAEA;EACAA;IACAC,QADA;IAEAC;EAFA,CADA;EAKAC,aALA;;EAMAC;IACA;MACAC,eACA;QACAC,cADA;QAEAH,UAFA;QAGAI,eAHA;QAIAC,sBAJA;QAKAC;UAAAH;QAAA;MALA,CADA,EAQA;QAAAA;QAAAH;QAAAI;MAAA,CARA,EASA;QAAAD;QAAAH;QAAAI;MAAA,CATA,CADA;MAYAG;QACAP,QADA;QAEAQ;MAFA;IAZA;EAiBA,CAxBA;;EAyBAC;IAEA;IACAC;MACAC;QAAAC;MAAA;QACA;QACA,oCAFA,CAGA;;QACAC;QACA;QACA;QACA,gCAPA,CAQA;QACA;;QACA;UACAC,UADA,CAEA;;UACAC;QACA,CAJA;MAKA,CAfA;IAgBA,CApBA;;IAqBA;IACAC;MACA;MACA;MACA,+DAHA,CAKA;;MACA;MACAC;MAEAJ;MAEA,+CAXA,CAaA;;MACAK;QAAAlB;QAAAmB;MAAA,GAdA,CAgBA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;;MACA;QACAX,mBADA;QAEAY,cAFA;QAGAH;MAHA,GAKAI,IALA,CAKAC;QACAT;;QACA;UACA,kCADA,CAEA;UACA;;UACA;YACA;UACA,CAFA;UAGAK;UACA;UACA;QACA;MACA,CAlBA,EAmBAK,KAnBA,CAmBAC;QACAX;QACA;MACA,CAtBA,EA9DA,CAqFA;IACA;;EA5GA,CAzBA;EAuIAY;IACA;MACA;IACA,CAHA;;IAIA;MACA;IACA,CANA;;IAOA;MACA;MACA;QACA;QACAZ;MACA,CALA,CAMA;MACA;MACA;MACA;;IACA;;EAjBA;AAvIA","names":["components","AsideBar","UserInfoCard","name","data","asideBarData","path","icon","componentName","params","downloadFileInfo","url","methods","downloadCurrentFile","axios","responseType","console","a","URL","dropFile","param","arr","progress","method","then","res","catch","err","watch"],"sourceRoot":"src/base","sources":["index.vue"],"sourcesContent":["<template>\r\n    <div class=\"Index\" @drop.prevent=\"dropFile\" @dragover.prevent>\r\n      <el-container>\r\n        <!-- 侧边栏 -->\r\n        <el-aside width=\"240px\">\r\n          <div class=\"asideHeader\">\r\n            <div class=\"logo\"><img src=\"../assets/img/logo.png\" alt=\"\" /></div>\r\n            <div class=\"name\">666盘</div>\r\n          </div>\r\n          <aside-bar :asideBarData=\"asideBarData\"></aside-bar>\r\n          <user-info-card class=\"userInfoCard\"></user-info-card>\r\n        </el-aside>\r\n        <el-main>\r\n          <router-view :key=\"$route.path\" ref=\"routerView\"></router-view>\r\n        </el-main>\r\n      </el-container>\r\n    </div>\r\n  </template>\r\n  \r\n  <script>\r\n  import axios from \"axios\";\r\n  \r\n  import AsideBar from \"../components/AsideBar.vue\";\r\n  import UserInfoCard from \"../components/UserInfoCard.vue\";\r\n\r\n  export default {\r\n    components: {\r\n      AsideBar,\r\n      UserInfoCard,\r\n    },\r\n    name: \"Index\",\r\n    data() {\r\n      return {\r\n        asideBarData: [\r\n          {\r\n            path: \"/files\",\r\n            name: \"文件\",\r\n            icon: \"wenjian\",\r\n            componentName: \"files\",\r\n            params: { path: \"/root\" },\r\n          },\r\n          { path: \"/albums\", name: \"相册\", icon: \"xiangce1\" },\r\n          { path: \"/collectes\", name: \"收藏夹\", icon: \"favorite\" },\r\n        ],\r\n        downloadFileInfo: {\r\n          name: \"\",\r\n          url: \"\",\r\n        },\r\n      };\r\n    },\r\n    methods: {\r\n  \r\n        // 点击下载文件的回调\r\n    downloadCurrentFile(name, url) {\r\n      axios.get(url, { responseType: \"blob\" }).then((res) => {\r\n        let blob = res.data;\r\n        let url = URL.createObjectURL(blob);\r\n        // download(url);\r\n        console.log(url);\r\n        let a = document.querySelector(\"#downloadCurrentFile\");\r\n        this.downloadFileInfo.name = name;\r\n        this.downloadFileInfo.url = url;\r\n        // console.log(a);\r\n        //   console.log(this.downloadFileInfo.url.split(\"com\")[1]);\r\n        this.$nextTick(() => {\r\n          a.click();\r\n          // 用完释放URL对象\r\n          URL.revokeObjectURL(url);\r\n        });\r\n      });\r\n    },\r\n      // 放下拖拽文件的回调\r\n      dropFile(e) {\r\n        // console.log(e);\r\n        // console.log(e.dataTransfer.files[0]);\r\n        let originLength = this.$store.state.uploadProgressList.length;\r\n  \r\n        // e.dataTransfer.files.forEach((item, index) => {\r\n          let param = new FormData();\r\n          param.append(\"file\", item);\r\n  \r\n          console.log(item);\r\n  \r\n          let arr = this.$store.state.uploadProgressList;\r\n  \r\n          // uploadProgressList push一个对象\r\n          arr.push({ name: item.name, progress: 0 });\r\n  \r\n          // let config = {\r\n          //   header: { \"Content-Type\": \"multipart/form-data\" },\r\n          //   onUploadProgress: (progressEvent) => {\r\n          //     // this.isUploadProgressShow = true;\r\n          //     // console.log(arr.length);\r\n          //     arr[index + originLength].progress =\r\n          //       ((progressEvent.loaded / progressEvent.total) * 100) | 0;\r\n          //     this.$store.commit(\"updateUploadProgressList\", arr);\r\n          //     // console.log(complete);\r\n          //     // console.log(progressEvent);\r\n          //   },\r\n          // };\r\n          // axios\r\n          //   .post(\r\n          //     `/api/eduoss/fileoss/upload/${this.$store.state.userInfo.id}?catalogue=${this.$store.state.currentFolder}`,\r\n          //     param,\r\n          //     config\r\n          //   )\r\n          //   .then((response) => {\r\n          //     console.log(response);\r\n          //     if (!response.data.success) {\r\n          //       this.$message.error(\r\n          //         `${response.data.data.file.name}上传失败,请稍后重试!`\r\n          //       );\r\n          //       // this.isUploadProgressShow = false;\r\n          //       // 不能直接用索引删除 因为如果之前已经有前面的索引被删除了，会导致后面的索引跟着发生变化 但又没有唯一标识 所以根据文件名进行删除（重名情况下默认删除第一个）\r\n          //       let idx = arr.findIndex((i) => {\r\n          //         return i.name == item.name;\r\n          //       });\r\n          //       arr.splice(idx, 1);\r\n          //       this.$store.commit(\"updateUploadProgressList\", arr);\r\n          //       return;\r\n          //     }\r\n          //     let data = {\r\n          //       memId: this.$store.state.userInfo.id,\r\n          //       url: response.data.data.file.url,\r\n          //       name: response.data.data.file.name,\r\n          //       type: response.data.data.file.type,\r\n          //       videoId: response.data.data.file.videoId,\r\n          //       filetype: response.data.data.file.filetype,\r\n          //       fdir: response.data.data.file.fdir,\r\n          //       size: response.data.data.file.size,\r\n          //     };\r\n          //     console.log(data);\r\n          //     this.updateToSQL(data, item.name);\r\n          //   })\r\n          this.$axios({\r\n            url: \"/file/upload\",\r\n            method: \"post\",\r\n            param,\r\n          })\r\n            .then((res) => {\r\n              console.log(res.data);\r\n              if (!response.data.success) {\r\n                this.$message.error(res.data.msg);\r\n                // this.isUploadProgressShow = false;\r\n                // 不能直接用索引删除 因为如果之前已经有前面的索引被删除了，会导致后面的索引跟着发生变化 但又没有唯一标识 所以根据文件名进行删除（重名情况下默认删除第一个）\r\n                let idx = arr.findIndex((i) => {\r\n                  return i.name == item.name;\r\n                });\r\n                arr.splice(idx, 1);\r\n                this.$store.commit(\"updateUploadProgressList\", arr);\r\n                return;\r\n              }\r\n            })\r\n            .catch((err) => {\r\n              console.log(err);\r\n              this.$message.error(\"上传失败!\");\r\n            });\r\n        // });\r\n      },\r\n    },\r\n    watch: {\r\n    \"$store.state.currentDownloadFileInfo\"(current) {\r\n      this.downloadCurrentFile(current.name, current.url);\r\n    },\r\n    \"$store.state.currentFolder\"(current) {\r\n      this.asideBarData[0].params.path = current;\r\n    },\r\n    \"$route.params.path\"(current) {\r\n      // console.log(this.$route.name==files);\r\n      if (this.$route.name == \"files\") {\r\n        this.$store.commit(\"updateCurrentFolder\", current);\r\n        console.log(207);\r\n      }\r\n      // if (this.isCreated) {\r\n      //   this.getListData();\r\n      //   // console.log(\"199\");\r\n      // }\r\n    },\r\n  },\r\n  };\r\n  </script>\r\n  \r\n  <style scoped>\r\n  .el-aside {\r\n    background-color: #f5f5f6;\r\n    height: 100vh;\r\n  }\r\n  \r\n  .el-main {\r\n    width: calc(100vw - 240px);\r\n  }\r\n  \r\n  .asideHeader {\r\n    display: flex;\r\n    align-items: center;\r\n    margin: 20px;\r\n    position: relative;\r\n  }\r\n  \r\n  .asideHeader .logo {\r\n    width: 50px;\r\n  }\r\n  \r\n  .asideHeader .logo img {\r\n    width: 100%;\r\n  }\r\n  \r\n  .asideHeader .name {\r\n    color: #25262b;\r\n    font-size: 20px;\r\n    letter-spacing: 4px;\r\n    font-weight: bold;\r\n    margin-left: 7px;\r\n  }\r\n  \r\n  .userInfoCard {\r\n    position: absolute;\r\n    bottom: 0;\r\n  }\r\n  </style>\r\n  "]},"metadata":{},"sourceType":"module"}